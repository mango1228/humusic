<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#06060C">
<title>Humusic</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#06060C;color:#eee;font-family:-apple-system,sans-serif;max-width:420px;margin:0 auto;min-height:100vh;overflow-x:hidden}
button{border:none;background:none;color:#eee;font-family:inherit;cursor:pointer;-webkit-tap-highlight-color:transparent}
.screen{display:none;padding:20px;padding-top:50px;min-height:100vh}
.screen.active{display:block}
.gradient{background:linear-gradient(135deg,#FF6B4A,#FF3CAC,#845EF7)}
.btn{padding:14px 36px;border-radius:99px;font-size:15px;font-weight:700;color:#fff}
.pill{padding:8px 16px;border-radius:99px;font-size:13px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.03);margin:4px;display:inline-block}
.pill.on{border-color:#FF6B4A;background:rgba(255,107,74,0.15)}
.card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:14px;margin-bottom:10px}
.dim{color:rgba(255,255,255,0.4)}
.muted{color:rgba(255,255,255,0.2)}
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:420px;background:rgba(6,6,12,0.95);border-top:1px solid rgba(255,255,255,0.06);display:flex;justify-content:space-around;padding:10px 0 16px;z-index:100}
.nav button{font-size:10px;display:flex;flex-direction:column;align-items:center;gap:4px}
.rec-btn{width:72px;height:72px;border-radius:50%;border:3px solid rgba(255,255,255,0.15);display:flex;align-items:center;justify-content:center}
.rec-btn .dot{width:26px;height:26px;border-radius:50%;background:#fff}
.rec-btn .stop{width:22px;height:22px;border-radius:4px;background:#fff}
canvas{width:100%;height:100px;display:block}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
h1{font-size:28px;font-weight:900;background:linear-gradient(135deg,#FF6B4A,#FF3CAC,#845EF7);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
</style>
</head>
<body>

<!-- HOME -->
<div id="s-home" class="screen active">
<p class="muted" style="font-size:11px;letter-spacing:2px;margin-bottom:4px">YOUR MUSIC STUDIO</p>
<h1>Humusic</h1>
<div class="card" style="margin-top:16px;display:flex;justify-content:space-between">
<span class="dim" style="font-size:12px">ğŸµ ë¬´ë£Œ í”Œëœ</span>
<span id="remain" style="font-size:12px;color:#FF6B4A;font-weight:600">ë‚¨ì€ ê³¡: 3ê³¡</span>
</div>
<div style="text-align:center;padding:30px 0;border-radius:20px;margin-top:16px;background:linear-gradient(160deg,rgba(255,107,74,0.1),rgba(132,94,247,0.05));border:1px solid rgba(255,107,74,0.1)">
<div style="font-size:48px;margin-bottom:12px">ğŸ¤</div>
<h2 style="font-size:18px;font-weight:700;line-height:1.5;margin-bottom:6px">í¥ì–¼ê±°ë¦¼ì„<br>ìŒì•…ìœ¼ë¡œ ë§Œë“¤ì–´ë³´ì„¸ìš”</h2>
<p class="dim" style="font-size:13px;margin-bottom:20px">ì½§ë…¸ë˜ë¥¼ ë…¹ìŒí•˜ë©´ AIê°€<br>ì™„ì„±ëœ ê³¡ìœ¼ë¡œ ë§Œë“¤ì–´ë“œë ¤ìš”</p>
<button class="btn gradient" onclick="goRecord()" style="box-shadow:0 6px 24px rgba(255,107,74,0.3)">ë…¹ìŒ ì‹œì‘í•˜ê¸°</button>
</div>
<div style="margin-top:24px">
<p class="muted" style="font-size:11px;letter-spacing:2px;margin-bottom:12px">HOW IT WORKS</p>
<div class="card">ğŸ™ <b>í¥ì–¼ê±°ë¦¼ ë…¹ìŒ</b> <span class="dim">â†’ í¸í•˜ê²Œ í¥ì–¼ê±°ë ¤ ì£¼ì„¸ìš”</span></div>
<div class="card">ğŸ¨ <b>ì¥ë¥´ & ë¶„ìœ„ê¸°</b> <span class="dim">â†’ ì›í•˜ëŠ” ìŠ¤íƒ€ì¼ ì„ íƒ</span></div>
<div class="card">âœ¨ <b>AIê°€ ê³¡ ì™„ì„±</b> <span class="dim">â†’ ê°€ì‚¬+ë©œë¡œë””+ë°˜ì£¼</span></div>
</div>
<div id="recent" style="margin-top:24px;display:none">
<p class="muted" style="font-size:11px;letter-spacing:2px;margin-bottom:12px">ìµœê·¼ ë§Œë“  ê³¡</p>
<div id="recent-list"></div>
</div>
<div style="height:80px"></div>
</div>

<!-- RECORDING -->
<div id="s-record" class="screen">
<div style="display:flex;justify-content:space-between;align-items:center">
<button class="dim" onclick="goHome()">â† ë’¤ë¡œ</button>
<span class="muted" style="font-size:12px;letter-spacing:1px">ë…¹ìŒ</span>
<div style="width:40px"></div>
</div>
<div style="text-align:center;margin-top:24px">
<div id="timer" style="font-size:52px;font-weight:300;letter-spacing:6px">0:00</div>
<div id="rec-status" class="muted" style="font-size:12px;margin-top:6px">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</div>
<div id="sim-badge" class="card" style="display:none;margin-top:10px;background:rgba(132,94,247,0.1);border-color:rgba(132,94,247,0.15)">
<span style="color:#845EF7;font-size:12px;font-weight:600">ğŸµ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ</span><br>
<span class="dim" style="font-size:11px">ì‹¤ì œ ë°°í¬ ì‹œ ë§ˆì´í¬ ë…¹ìŒ ì‘ë™</span>
</div>
</div>
<div class="card" style="margin-top:16px;padding:16px"><canvas id="wave"></canvas></div>
<p class="muted" style="font-size:11px;letter-spacing:1.5px;margin-top:16px">ì¥ë¥´</p>
<div id="genres" style="margin:8px 0 12px;overflow-x:auto;white-space:nowrap"></div>
<p class="muted" style="font-size:11px;letter-spacing:1.5px">ë¶„ìœ„ê¸°</p>
<div id="moods" style="margin:8px 0 16px;overflow-x:auto;white-space:nowrap"></div>
<div style="display:flex;justify-content:center;align-items:center;gap:24px;padding:20px 0">
<button id="btn-reset" onclick="resetRec()" style="display:none;width:48px;height:48px;border-radius:50%;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);font-size:20px">â†º</button>
<button id="btn-rec" class="rec-btn gradient" onclick="toggleRec()"><div class="dot"></div></button>
<button id="btn-next" onclick="submitGen()" style="display:none;width:48px;height:48px;border-radius:50%;font-size:18px" class="gradient">â†’</button>
</div>
</div>

<!-- GENERATING -->
<div id="s-gen" class="screen" style="display:none;text-align:center;padding-top:40vh">
<div style="width:80px;height:80px;border-radius:50%;border:3px solid rgba(255,255,255,0.06);border-top-color:#FF6B4A;animation:spin 1s linear infinite;margin:0 auto 24px"></div>
<h2 style="font-size:18px;font-weight:700;margin-bottom:8px">AIê°€ ê³¡ì„ ë§Œë“¤ê³  ìˆì–´ìš”</h2>
<p id="gen-style" class="dim" style="font-size:13px;margin-bottom:6px"></p>
<p id="gen-msg" style="color:#FF6B4A;font-size:12px;animation:pulse 2s infinite;margin-bottom:24px"></p>
<div style="width:240px;height:5px;border-radius:99px;background:rgba(255,255,255,0.03);margin:0 auto;overflow:hidden">
<div id="gen-bar" style="width:0%;height:100%;border-radius:99px;transition:width .3s" class="gradient"></div>
</div>
<span id="gen-pct" class="muted" style="font-size:12px;margin-top:8px;display:block">0%</span>
</div>

<!-- RESULT -->
<div id="s-result" class="screen">
<div style="display:flex;justify-content:space-between;align-items:center">
<button class="dim" onclick="goHome()">â† í™ˆ</button>
<span class="muted" style="font-size:12px;letter-spacing:1px">ì™„ì„±</span>
<div style="width:40px"></div>
</div>
<div style="text-align:center;margin-top:16px">
<div id="album-art" style="width:200px;height:200px;border-radius:20px;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;font-size:56px;box-shadow:0 12px 40px rgba(255,60,172,0.15)" class="gradient">ğŸ¶</div>
<h2 id="song-title" style="font-size:20px;font-weight:700"></h2>
<p id="song-info" class="dim" style="font-size:13px;margin-top:4px"></p>
</div>
<div style="margin-top:16px">
<audio id="player" style="width:100%;margin-bottom:8px" controls></audio>
<div id="no-audio" class="dim" style="text-align:center;font-size:12px;display:none">ë°ëª¨ ëª¨ë“œ - ì‹¤ì œ ë°°í¬ ì‹œ ì¬ìƒ ê°€ëŠ¥</div>
</div>
<div id="lyrics-box" style="margin-top:20px;display:none">
<p class="muted" style="font-size:11px;letter-spacing:1.5px;margin-bottom:8px">ê°€ì‚¬</p>
<div class="card"><p id="lyrics" style="color:rgba(255,255,255,0.55);font-size:13px;line-height:2;white-space:pre-line;font-style:italic"></p></div>
</div>
<div style="display:flex;gap:8px;margin-top:16px">
<button class="card" style="flex:1;text-align:center;font-size:13px;font-weight:600" onclick="goRecord()">ğŸ”„ ë‹¤ì‹œ ë§Œë“¤ê¸°</button>
</div>
<div style="height:80px"></div>
</div>

<!-- LIBRARY -->
<div id="s-library" class="screen">
<h1 style="font-size:24px">ë‚´ ë³´ê´€í•¨</h1>
<p class="dim" style="font-size:13px;margin-top:4px" id="lib-count">0ê³¡</p>
<div id="lib-list" style="margin-top:16px"></div>
<div id="lib-empty" style="text-align:center;padding:60px 0">
<div style="font-size:48px;margin-bottom:12px">ğŸµ</div>
<p class="dim">ì•„ì§ ë§Œë“  ê³¡ì´ ì—†ì–´ìš”</p>
<button class="btn gradient" onclick="goRecord()" style="margin-top:16px">ì²« ê³¡ ë§Œë“¤ëŸ¬ ê°€ê¸°</button>
</div>
<div style="height:80px"></div>
</div>

<!-- NAV -->
<div class="nav" id="navbar">
<button onclick="goHome()"><span>ğŸ </span><span>í™ˆ</span></button>
<button onclick="goLib()"><span>ğŸµ</span><span>ë³´ê´€í•¨</span></button>
</div>

<script>
var G={genre:"pop",mood:"chill",recording:false,simMode:false,time:0,songs:[],created:0},
mediaRec,audioCtx,analyser,stream,chunks=[],timerIv,canvasAnim,
GENRES=[{id:"pop",l:"Pop",e:"ğŸµ"},{id:"rnb",l:"R&B",e:"ğŸ’œ"},{id:"hiphop",l:"Hip-Hop",e:"ğŸ”¥"},{id:"ballad",l:"Ballad",e:"ğŸŒ™"},{id:"rock",l:"Rock",e:"ğŸ¸"},{id:"jazz",l:"Jazz",e:"ğŸ·"},{id:"electronic",l:"Electronic",e:"âš¡"},{id:"indie",l:"Indie",e:"ğŸŒ¿"}],
MOODS=[{id:"chill",l:"í¸ì•ˆí•œ",e:"ğŸ˜Œ"},{id:"energetic",l:"ì‹ ë‚˜ëŠ”",e:"ğŸ’ƒ"},{id:"melancholy",l:"ê°ì„±ì ì¸",e:"ğŸŒ§"},{id:"romantic",l:"ë¡œë§¨í‹±",e:"ğŸ’•"},{id:"epic",l:"ì›…ì¥í•œ",e:"ğŸ”"},{id:"dreamy",l:"ëª½í™˜ì ì¸",e:"â˜ï¸"}],
TITLES={pop:"ë°¤í•˜ëŠ˜ ì•„ë˜ì„œ",rnb:"Sunday Groove",hiphop:"My Anthem",ballad:"ë¹—ì†Œë¦¬ í¸ì§€",rock:"Burning Road",jazz:"Midnight Sax",electronic:"ë„¤ì˜¨ ì‹œí‹°",indie:"í’€ë°­ ìœ„ ì˜¤í›„"},
LYRICS={pop:"ë°¤í•˜ëŠ˜ ì•„ë˜ ê±¸ì–´ê°€ëŠ” ì´ ê¸¸\në„ˆì™€ ë‚˜ ì‚¬ì´ íë¥´ëŠ” melody\ní¥ì–¼ê±°ë¦¬ë˜ ê·¸ ë…¸ë˜ê°€\nì˜¤ëŠ˜ ë°¤ ìš°ë¦¬ì˜ ì´ì•¼ê¸°ê°€ ë¼\n\në¼ë¼ë¼ ë¶ˆëŸ¬ë´ ì´ ë…¸ë˜ë¥¼\nì„¸ìƒì´ ë©ˆì¶˜ ê²ƒì²˜ëŸ¼\nìš°ë¦¬ ë‘˜ë§Œì˜ ì‹œê°„ ì†ì—\nì˜ì›íˆ í•¨ê»˜ ì¶¤ì„ ì¶°",ballad:"ì°½ë°–ì— ë¹„ê°€ ë‚´ë¦¬ëŠ” ë‚ \në„ˆë¥¼ ë– ì˜¬ë¦¬ë©° í¥ì–¼ê±°ë ¤\nìŠí˜€ì§ˆ ì¤„ ì•Œì•˜ë˜ ë©œë¡œë””ê°€\në‹¤ì‹œ ë‚´ ê°€ìŠ´ì„ ì ì…”\n\në³´ê³  ì‹¶ë‹¤ ë§í•˜ê³  ì‹¶ì–´\nì´ ë…¸ë˜ì— ë‹´ì•„ì„œ\në°”ëŒì— ì‹¤ë ¤ ë„ˆì—ê²Œ\në‚´ ë§ˆìŒì´ ë‹¿ê¸°ë¥¼",hiphop:"Yo ë¨¸ë¦¿ì† ë©œë¡œë”” í„°ì ¸ ë‚˜ì™€\në¹„íŠ¸ ìœ„ì— ì˜¬ë ¤ ë´ ë‚´ ì´ì•¼ê¸°\nê¸¸ê±°ë¦¬ ìœ„ í¥ì–¼ê±°ë¦¼ì´\nì„¸ìƒì„ ë’¤í”ë“¤ anthemì´ ë¼",rnb:"ë‹¬ë¹›ì´ ë‚´ë ¤ì•‰ì€ ì´ ë°¤\në„ˆì˜ ëª©ì†Œë¦¬ê°€ ë‚  ê°ì‹¸ê³ \në¶€ë“œëŸ¬ìš´ ë°”ëŒì²˜ëŸ¼\në‚´ ê³ì— ë¨¸ë¬¼ëŸ¬ì¤˜"};

function show(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');document.getElementById('navbar').style.display=(id==='s-home'||id==='s-library')?'flex':'none';}
function fmtT(s){return Math.floor(s/60)+':'+String(s%60).padStart(2,'0');}
function goHome(){show('s-home');updateRecent();}
function goRecord(){G.time=0;G.simMode=false;show('s-record');initPills();updateRecUI();}
function goLib(){show('s-library');renderLib();}

function initPills(){
var gh=GENRES.map(g=>'<button class="pill'+(G.genre===g.id?' on':'')+'" onclick="G.genre=\''+g.id+'\';initPills()">'+g.e+' '+g.l+'</button>').join('');
var mh=MOODS.map(m=>'<button class="pill'+(G.mood===m.id?' on':'')+'" onclick="G.mood=\''+m.id+'\';initPills()">'+m.e+' '+m.l+'</button>').join('');
document.getElementById('genres').innerHTML=gh;
document.getElementById('moods').innerHTML=mh;
}

function updateRecUI(){
document.getElementById('timer').textContent=fmtT(G.time);
document.getElementById('rec-status').textContent=G.recording?'â— ë…¹ìŒ ì¤‘...':G.time>0?'ë…¹ìŒ ì™„ë£Œ':'ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”';
document.getElementById('rec-status').style.color=G.recording?'#FF6B4A':'rgba(255,255,255,0.2)';
document.getElementById('sim-badge').style.display=G.simMode&&G.recording?'block':'none';
document.getElementById('btn-reset').style.display=G.time>0&&!G.recording?'block':'none';
document.getElementById('btn-next').style.display=G.time>=3&&!G.recording?'block':'none';
var b=document.getElementById('btn-rec');
b.style.background=G.recording?'rgba(231,76,60,0.9)':'';
b.className=G.recording?'rec-btn':'rec-btn gradient';
b.innerHTML=G.recording?'<div class="stop"></div>':'<div class="dot"></div>';
}

function resetRec(){G.time=0;G.simMode=false;updateRecUI();}

async function toggleRec(){
if(G.recording){clearInterval(timerIv);G.recording=false;
if(!G.simMode&&mediaRec&&mediaRec.state!=='inactive')mediaRec.stop();
if(stream)stream.getTracks().forEach(t=>t.stop());
if(audioCtx)audioCtx.close().catch(()=>{});
updateRecUI();return;}
try{
stream=await navigator.mediaDevices.getUserMedia({audio:true});
audioCtx=new(window.AudioContext||window.webkitAudioContext)();
var src=audioCtx.createMediaStreamSource(stream);
analyser=audioCtx.createAnalyser();analyser.fftSize=256;src.connect(analyser);
mediaRec=new MediaRecorder(stream);chunks=[];
mediaRec.ondataavailable=function(e){if(e.data.size>0)chunks.push(e.data);};
mediaRec.start(100);G.simMode=false;
}catch(e){G.simMode=true;}
G.recording=true;G.time=0;
timerIv=setInterval(function(){G.time++;updateRecUI();},1000);
updateRecUI();drawWave();
}

function drawWave(){
var c=document.getElementById('wave');if(!c)return;
var ctx=c.getContext('2d'),dpr=window.devicePixelRatio||1;
c.width=c.offsetWidth*dpr;c.height=c.offsetHeight*dpr;ctx.scale(dpr,dpr);
var W=c.offsetWidth,H=c.offsetHeight,bars=40,bw=3,gap=(W-bars*bw)/(bars-1),data=new Uint8Array(128),t=0;
cancelAnimationFrame(canvasAnim);
function draw(){ctx.clearRect(0,0,W,H);
if(analyser&&G.recording&&!G.simMode)analyser.getByteFrequencyData(data);
t+=.06;
for(var i=0;i<bars;i++){var v;
if(G.simMode&&G.recording){v=.2+.4*Math.sin(t+i*.3)*Math.sin(t*.7+i*.15)+.15*Math.cos(t*1.3+i*.5);v=Math.max(.05,Math.min(1,v));}
else if(analyser&&G.recording){v=data[Math.floor(i*128/bars)]/255;}else{v=0;}
var h=Math.max(3,v*H*.85),x=i*(bw+gap),y=(H-h)/2;
var g=ctx.createLinearGradient(x,y,x,y+h);
g.addColorStop(0,'rgba(255,107,74,'+(0.3+v*0.7)+')');
g.addColorStop(1,'rgba(132,94,247,'+(0.3+v*0.7)+')');
ctx.fillStyle=g;ctx.beginPath();ctx.roundRect(x,y,bw,h,2);ctx.fill();}
canvasAnim=requestAnimationFrame(draw);}draw();
}

async function submitGen(){
if(G.time<3)return;
G.created++;
document.getElementById('remain').textContent='ë‚¨ì€ ê³¡: '+(3-G.created)+'ê³¡';
var gl=GENRES.find(g=>g.id===G.genre),ml=MOODS.find(m=>m.id===G.mood);
show('s-gen');
document.getElementById('gen-style').textContent=(gl?gl.l:'')+' Â· '+(ml?ml.l:'');
document.getElementById('gen-msg').textContent='ì„œë²„ì— ì „ì†¡ ì¤‘...';
document.getElementById('gen-bar').style.width='0%';
document.getElementById('gen-pct').textContent='0%';

var taskId=null;
try{
var r=await fetch('/api/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({genre:G.genre,mood:G.mood})});
var d=await r.json();taskId=d.taskId;
}catch(e){taskId=null;}

if(taskId){pollStatus(taskId,gl,ml);}
else{runDemo(gl,ml);}
}

function pollStatus(taskId,gl,ml){
var p=10;setProgress(p,'AIê°€ ë©œë¡œë””ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...');
var iv=setInterval(async function(){
try{
var r=await fetch('/api/status?taskId='+taskId);
var d=await r.json();
if(d.status==='completed'&&d.song){
clearInterval(iv);setProgress(100,'ì™„ì„±!');
var now=new Date(),ds=(now.getMonth()+1)+'ì›” '+now.getDate()+'ì¼';
var song={id:Date.now(),title:d.song.title||'ë‚˜ì˜ ë…¸ë˜',audioUrl:d.song.audioUrl||'',imageUrl:d.song.imageUrl||'',lyrics:d.song.lyrics||'',genreLabel:gl?gl.l:'',moodLabel:ml?ml.l:'',date:ds};
G.songs.unshift(song);
setTimeout(function(){showResult(song);},500);
}else if(d.status==='failed'){clearInterval(iv);runDemo(gl,ml);}
else{p=Math.min(90,p+5);
var msg=p<30?'AIê°€ ë©œë¡œë””ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...':p<60?'ê°€ì‚¬ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”...':'ë°˜ì£¼ë¥¼ ì™„ì„±í•˜ê³  ìˆì–´ìš”...';
setProgress(p,msg);}
}catch(e){clearInterval(iv);runDemo(gl,ml);}
},3000);
}

function runDemo(gl,ml){
var p=5;
var iv=setInterval(function(){
p+=Math.random()*5+2;
if(p>=100){clearInterval(iv);setProgress(100,'ì™„ì„±!');
var now=new Date(),ds=(now.getMonth()+1)+'ì›” '+now.getDate()+'ì¼';
var song={id:Date.now(),title:TITLES[G.genre]||'ë‚˜ì˜ ë…¸ë˜',audioUrl:'',lyrics:LYRICS[G.genre]||LYRICS.pop,genreLabel:gl?gl.l:'',moodLabel:ml?ml.l:'',date:ds,isDemo:true};
G.songs.unshift(song);
setTimeout(function(){showResult(song);},500);return;}
var msg=p<20?'AIê°€ ë©œë¡œë””ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...':p<50?'ê°€ì‚¬ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”...':p<80?'ë°˜ì£¼ë¥¼ ì™„ì„±í•˜ê³  ìˆì–´ìš”...':'ìµœì¢… ë¯¹ì‹± ì¤‘...';
setProgress(p,msg);
},400);
}

function setProgress(p,msg){
p=Math.min(100,Math.round(p));
document.getElementById('gen-bar').style.width=p+'%';
document.getElementById('gen-pct').textContent=p+'%';
document.getElementById('gen-msg').textContent=msg||'';
}

function showResult(song){
show('s-result');
document.getElementById('song-title').textContent=song.title;
document.getElementById('song-info').textContent=song.genreLabel+' Â· '+song.moodLabel+(song.isDemo?' Â· Demo':'');
var player=document.getElementById('player');
var noAudio=document.getElementById('no-audio');
if(song.audioUrl){player.src=song.audioUrl;player.style.display='block';noAudio.style.display='none';}
else{player.style.display='none';noAudio.style.display='block';}
if(song.lyrics){document.getElementById('lyrics').textContent=song.lyrics;document.getElementById('lyrics-box').style.display='block';}
else{document.getElementById('lyrics-box').style.display='none';}
if(song.imageUrl){document.getElementById('album-art').style.background='url('+song.imageUrl+') center/cover';}
}

function updateRecent(){
var box=document.getElementById('recent'),list=document.getElementById('recent-list');
if(G.songs.length===0){box.style.display='none';return;}
box.style.display='block';
list.innerHTML=G.songs.slice(0,2).map(function(s,i){return '<div class="card" style="display:flex;align-items:center;gap:12px;cursor:pointer" onclick="showResult(G.songs['+i+'])"><div style="width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0" class="gradient">â–¶</div><div><b style="font-size:14px">'+s.title+'</b><br><span class="dim" style="font-size:12px">'+s.genreLabel+' Â· '+s.moodLabel+'</span></div></div>';}).join('');
}

function renderLib(){
var list=document.getElementById('lib-list'),empty=document.getElementById('lib-empty');
document.getElementById('lib-count').textContent=G.songs.length+'ê³¡';
if(G.songs.length===0){list.innerHTML='';empty.style.display='block';return;}
empty.style.display='none';
list.innerHTML=G.songs.map(function(s,i){return '<div class="card" style="display:flex;align-items:center;gap:12px;cursor:pointer" onclick="showResult(G.songs['+i+'])"><div style="width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0" class="gradient">â–¶</div><div style="flex:1;min-width:0"><b style="font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block">'+s.title+'</b><span class="dim" style="font-size:12px">'+s.genreLabel+' Â· '+s.moodLabel+'</span></div><span class="muted" style="font-size:11px;flex-shrink:0">'+s.date+'</span></div>';}).join('');
}

goHome();
</script>
</body>
</html>
